<!doctype html>
<html lang="pt-BR">
<!--!
	@file todo.html
	@brief P√°gina de gerenciamento de tarefas da aplica√ß√£o GloboTech
	@details Interface para adicionar, visualizar e gerenciar tarefas individuais
	@author GloboTech Team 5
	@version 1.0
-->

<!--!
	@section head_section Configura√ß√µes do documento
	@brief Define metadados, t√≠tulo e refer√™ncias CSS/Bootstrap
-->
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Minhas Tarefas</title>

	<!-- Bootstrap 5.3.3 (CSS-only) -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

	<link rel="stylesheet" href="style.css"/>
</head>

<!--!
	@section body_section Corpo da p√°gina de tarefas
	@brief Cont√©m navbar, conte√∫do principal e funcionalidades de tarefas
-->
<body class="todo-page">
	<!--!
		@section header_section Cabe√ßalho da aplica√ß√£o
		@brief Barra superior com logo, navega√ß√£o e logout (id√™ntico ao dashboard)
	-->
	<header class="header">
		<!--!
			@subsection logo_section Logo da aplica√ß√£o
			@brief Exibe o nome e √≠cone do sistema GloboTech
		-->
		<div class="logo">üìã GloboTech</div>
		
		<!--!
			@subsection user_info_section Informa√ß√µes do usu√°rio e navega√ß√£o
			@brief Mostra bot√£o dashboard, avatar, nome do usu√°rio e bot√£o de sair
		-->
		<div class="user-info">
			<a href="dashboard.html" class="dashboard-btn">‚Üê Dashboard</a>
			<div class="user-avatar">JD</div>
			<span class="user-name">Jo√£o Silva</span>
			<a href="login.html" class="logout-btn">Sair</a>
		</div>
	</header>

	<!--!
		@section main_content Conte√∫do principal da p√°gina
		@brief Container principal com header e grid de funcionalidades
	-->
	<main class="main-content">
		<div class="container-xxl">
			<!--!
				@section page_header Cabe√ßalho da p√°gina
				@brief T√≠tulo e subt√≠tulo da p√°gina de tarefas
			-->
			<section class="glass p-4 p-md-5 mb-4">
				<h1 class="title-gradient mb-1">Lista de Tarefas</h1>
				<p class="subtitle mb-0">Organize suas tarefas com prioridades</p>
			</section>

		<!--!
			@section content_grid Grid de conte√∫do
			@brief Layout responsivo com formul√°rio e lista de tarefas
		-->
		<div class="row g-4">
			<!--!
				@section add_task_column Coluna do formul√°rio
				@brief Formul√°rio para adicionar novas tarefas
			-->
			<div class="col-12 col-lg-4">
				<!--!
					@subsection add_task_card Card de adicionar tarefa
					@brief Formul√°rio com campos para t√≠tulo, respons√°vel e prioridade
				-->
				<section class="glass p-4 h-100 add-task-card">
					<h2 class="h5 mb-0">Adicionar tarefa</h2>
					<hr class="my-3">
					
					<!--!
						@subsubsection task_form Formul√°rio de nova tarefa
						@brief Campos de input para criar tarefa com valida√ß√£o
					-->
					<form class="add-form" action="#" method="get">
						<!--!
							@paragraph title_field Campo de t√≠tulo
							@brief Input obrigat√≥rio para o t√≠tulo da tarefa
						-->
						<div class="mb-3">
							<label class="form-label">T√≠tulo</label>
							<input class="form-control" name="titulo" placeholder="Ex.: Revisar documenta√ß√£o" required>
						</div>
						
						<!--!
							@paragraph assignee_field Campo de respons√°vel
							@brief Input opcional para atribuir tarefa a algu√©m
						-->
						<div class="mb-3">
							<label class="form-label">Atribuir para</label>
							<input class="form-control" name="assignee" placeholder="Ex.: Maria (opcional)">
						</div>
						
						<!--!
							@paragraph priority_field Campo de prioridade
							@brief Select para definir prioridade da tarefa (Baixa/M√©dia/Alta)
						-->
						<div class="mb-3">
							<label class="form-label">Prioridade</label>
							<select class="form-select" name="prio">
								<option value="low">Baixa</option>
								<option value="medium">M√©dia</option>
								<option value="high">Alta</option>
							</select>
						</div>
						
						<!--!
							@paragraph form_actions A√ß√µes do formul√°rio
							@brief Bot√µes de adicionar e voltar ao dashboard
						-->
						<div class="d-flex gap-2">
							<button class="btn btn-primary" type="submit">Adicionar</button>
							<a class="btn btn-outline-secondary" href="dashboard.html">Voltar</a>
						</div>
					</form>
				</section>
			</div>

			<!--!
				@section task_list_column Coluna da lista de tarefas
				@brief Exibe as tarefas existentes com op√ß√µes de gerenciamento
			-->
			<div class="col-12 col-lg-8">
				<!--!
					@subsection task_list_card Card principal de tarefas
					@brief Container com header, estat√≠sticas e lista de tarefas
				-->
				<section class="glass p-4">
					<!--!
						@subsubsection list_header Header da lista
						@brief T√≠tulo da lista atual e bot√µes de a√ß√£o
					-->
					<div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
						<h2 class="h5 mb-0" id="currentListName">Carregando...</h2>
						<div class="btn-group">
							<button class="btn btn-outline-primary" onclick="createNewList()">Nova lista</button>
							<button class="btn btn-outline-danger" onclick="removeCurrentList()" id="removeListBtn">Remover lista</button>
						</div>
					</div>

					<hr class="my-3">
					
					<!--!
						@subsubsection list_stats Estat√≠sticas da lista
						@brief Mostra progresso de conclus√£o das tarefas
					-->
					<div class="text-muted mb-3">2 de 5 tarefas conclu√≠das</div>

					<!--!
						@subsubsection tasks_container Container de tarefas
						@brief Lista com todas as tarefas carregadas dinamicamente via JavaScript
					-->
					<div class="list-group list-group-flush">
						<!-- Tarefas ser√£o carregadas dinamicamente aqui -->
					</div>

					<!--!
						@subsubsection empty_state Estado vazio
						@brief Mensagem exibida quando n√£o h√° tarefas (oculta por padr√£o)
					-->
					<div class="empty-state text-center p-5 mt-3" id="emptyState">
						Nenhuma tarefa por aqui ainda ‚Äî adicione a primeira! ‚ú®
					</div>

					<!--!
						@subsubsection bulk_actions A√ß√µes em massa
						@brief Bot√£o para remover tarefas conclu√≠das
					-->
					<div class="d-flex justify-content-end mt-3" id="bulkActions" style="display: none !important;">
						<button class="btn btn-outline-danger" onclick="removeCompletedTasks()">
							Remover Conclu√≠das
						</button>
					</div>
				</section>
			</div>
		</div>
		</div>
	</main>

	<!-- Scripts JavaScript -->
	<script src="script.js"></script>
	<script>
		// Carrega e exibe as tarefas quando a p√°gina carregar
		document.addEventListener('DOMContentLoaded', function() {
			updateCurrentListDisplay();
			renderTasks();
			setupFormHandler();
		});

		// Atualiza a exibi√ß√£o da lista atual
		function updateCurrentListDisplay() {
			const currentList = taskManager.getListById(taskManager.currentListId);
			const listNameElement = document.getElementById('currentListName');
			const removeBtn = document.getElementById('removeListBtn');
			
			if (currentList) {
				listNameElement.textContent = currentList.name;
				
				// Desabilita remo√ß√£o de listas padr√£o
				if (['trabalho', 'pessoal', 'estudos'].includes(currentList.id)) {
					removeBtn.style.display = 'none';
				} else {
					removeBtn.style.display = 'inline-block';
				}
			} else {
				listNameElement.textContent = 'Lista n√£o encontrada';
				removeBtn.style.display = 'none';
			}
		}

		// Configura o formul√°rio para adicionar novas tarefas
		function setupFormHandler() {
			const form = document.querySelector('.add-form');
			form.addEventListener('submit', function(e) {
				e.preventDefault();
				
				const title = form.querySelector('input[name="titulo"]').value;
				const assignee = form.querySelector('input[name="assignee"]').value;
				const priority = form.querySelector('select[name="prio"]').value;
				
				// Adiciona a tarefa usando o sistema de gerenciamento
				const result = taskManager.addTask(title, priority);
				
				if (result.success) {
					// Se tem respons√°vel, adiciona ao objeto da tarefa
					if (assignee.trim()) {
						result.task.assignee = assignee.trim();
						taskManager.saveTasks();
					}
					
					// Limpa o formul√°rio
					form.reset();
					
					// Atualiza a lista de tarefas
					renderTasks();
					
					// Mostra mensagem de sucesso
					showNotification('Tarefa adicionada com sucesso!', 'success');
				} else {
					showNotification(result.message, 'error');
				}
			});
		}

		// Renderiza todas as tarefas na tela
		function renderTasks() {
			const tasks = taskManager.getAllTasks();
			const container = document.querySelector('.list-group.list-group-flush');
			const emptyState = document.getElementById('emptyState');
			const bulkActions = document.getElementById('bulkActions');
			const statsElement = document.querySelector('.text-muted.mb-3');
			
			// Limpa o container de tarefas
			container.innerHTML = '';
			
			if (tasks.length === 0) {
				// Mostra estado vazio
				emptyState.style.display = 'block';
				bulkActions.style.display = 'none';
				statsElement.textContent = 'Nenhuma tarefa criada';
			} else {
				// Esconde estado vazio
				emptyState.style.display = 'none';
				
				// Calcula estat√≠sticas
				const completedCount = tasks.filter(t => t.completed).length;
				const totalCount = tasks.length;
				statsElement.textContent = `${completedCount} de ${totalCount} tarefas conclu√≠das`;
				
				// Mostra bot√£o de remover conclu√≠das se houver tarefas conclu√≠das
				if (completedCount > 0) {
					bulkActions.style.display = 'flex';
				} else {
					bulkActions.style.display = 'none';
				}
				
				// Renderiza cada tarefa
				tasks.forEach(task => {
					const taskElement = createTaskElement(task);
					container.appendChild(taskElement);
				});
			}
		}

		// Cria o elemento HTML para uma tarefa
		function createTaskElement(task) {
			const div = document.createElement('div');
			div.className = `list-group-item task-item priority-border priority-${task.priority}`;
			
			const priorityLabels = {
				'low': 'Baixa',
				'medium': 'M√©dia',
				'high': 'Alta'
			};
			
			div.innerHTML = `
				<div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-2">
					<div class="form-check">
						<input class="form-check-input" type="checkbox" id="task-${task.id}" ${task.completed ? 'checked' : ''} 
							   onchange="toggleTaskStatus(${task.id})">
						<label class="form-check-label" for="task-${task.id}">${task.title}</label>
					</div>
					<div class="d-flex align-items-center gap-2">
						${task.assignee ? `<span class="badge badge-assignee text-white">${task.assignee}</span>` : ''}
						<span class="badge text-bg-light border">
							<span class="dot dot-${task.priority}"></span>${priorityLabels[task.priority]}
						</span>
						<button class="btn btn-sm btn-outline-danger" onclick="removeTask(${task.id})">Remover</button>
					</div>
				</div>
			`;
			
			return div;
		}

		// Alterna o status de uma tarefa (conclu√≠da/pendente)
		function toggleTaskStatus(taskId) {
			const result = taskManager.toggleTask(taskId);
			
			if (result.success) {
				renderTasks();
				const status = result.task.completed ? 'conclu√≠da' : 'reaberta';
				showNotification(`Tarefa ${status}!`, 'success');
			} else {
				showNotification(result.message, 'error');
			}
		}

		// Remove uma tarefa espec√≠fica
		function removeTask(taskId) {
			if (confirm('Tem certeza que deseja remover esta tarefa?')) {
				const result = taskManager.removeTask(taskId);
				
				if (result.success) {
					renderTasks();
					showNotification('Tarefa removida com sucesso!', 'success');
				} else {
					showNotification(result.message, 'error');
				}
			}
		}

		// Remove todas as tarefas conclu√≠das
		function removeCompletedTasks() {
			const completedCount = taskManager.getCompletedTasks().length;
			
			if (completedCount === 0) {
				showNotification('N√£o h√° tarefas conclu√≠das para remover!', 'info');
				return;
			}
			
			if (confirm(`Tem certeza que deseja remover ${completedCount} tarefa(s) conclu√≠da(s)?`)) {
				const result = taskManager.removeCompletedTasks();
				
				if (result.success) {
					renderTasks();
					showNotification(result.message, 'success');
				} else {
					showNotification(result.message, 'error');
				}
			}
		}

		// Cria uma nova lista
		function createNewList() {
			const listName = prompt('Digite o nome da nova lista:');
			
			if (!listName) {
				return; // Usu√°rio cancelou
			}
			
			const result = taskManager.createList(listName);
			
			if (result.success) {
				showNotification(result.message, 'success');
				// Redireciona para a nova lista
				setTimeout(() => {
					window.location.href = `todo.html?list=${result.list.id}`;
				}, 1000);
			} else {
				showNotification(result.message, 'error');
			}
		}

		// Remove a lista atual
		function removeCurrentList() {
			const currentList = taskManager.getListById(taskManager.currentListId);
			
			if (!currentList) {
				showNotification('Lista n√£o encontrada!', 'error');
				return;
			}
			
			if (['trabalho', 'pessoal', 'estudos'].includes(currentList.id)) {
				showNotification('N√£o √© poss√≠vel remover listas padr√£o!', 'error');
				return;
			}
			
			if (confirm(`Tem certeza que deseja remover a lista "${currentList.name}" e todas suas tarefas?`)) {
				const result = taskManager.removeList(taskManager.currentListId);
				
				if (result.success) {
					showNotification(result.message, 'success');
					// Redireciona para o dashboard
					setTimeout(() => {
						window.location.href = 'dashboard.html';
					}, 1000);
				} else {
					showNotification(result.message, 'error');
				}
			}
		}

		// Mostra notifica√ß√µes para o usu√°rio
		function showNotification(message, type = 'info') {
			// Remove notifica√ß√£o anterior se existir
			const existingNotification = document.querySelector('.notification');
			if (existingNotification) {
				existingNotification.remove();
			}
			
			// Cria nova notifica√ß√£o
			const notification = document.createElement('div');
			notification.className = `notification alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
			notification.style.cssText = 'top: 100px; right: 20px; z-index: 9999; min-width: 300px;';
			notification.textContent = message;
			
			document.body.appendChild(notification);
			
			// Remove automaticamente ap√≥s 3 segundos
			setTimeout(() => {
				if (notification && notification.parentNode) {
					notification.remove();
				}
			}, 3000);
		}
	</script>
</body>
</html>